<!DOCTYPE html>
<html>
	<script>
		var currentAPIRes;
		var updateCount = 0;
		var lastID = '';
		var showInterval = 6000;
		
		function getViaApi(){
			const Http = new XMLHttpRequest();
			const url='/teamdonations.json';
			Http.open("GET", url);
			Http.send();
			Http.onreadystatechange=function(){
				if(this.readyState==4 && this.status==200){
					console.log('success request');
					updateCount++;
					currentAPIRes = JSON.parse(Http.responseText);
					var recentID = currentAPIRes[0].donorID;
					if(lastID == ''){
						lastID = recentID;
					}
					if(lastID != recentID){
						lastID = recentID;
						var wowElem = document.getElementById("wowplayer");
						wowElem.load();
						wowElem.play();
						var lastDonator = currentAPIRes[0].displayName;
						var lastAmount = currentAPIRes[0].amount;
						document.getElementById('postLogoText').innerHTML = 
							'Thanks to ' + lastDonator + ' for a donation of $' + lastAmount + '!';
						var blinks = document.getElementById('outercase');
						blinks.style.opacity = '1';
						var intervalItem = window.setInterval(function() {
						  blinks.style.opacity = '0';
						  window.clearInterval(intervalItem);
						}, showInterval);
					}
					
				}
			}
		}
		getViaApi();
		setInterval(getViaApi, 10000);
	</script>
	<head>
		<link href='https://fonts.googleapis.com/css?family=Acme' rel='stylesheet'>
		<link href="fragforce.css" rel="stylesheet" type="text/css">
	</head>
	<body>
		<div id="outercase" width="300px" height="400px" class="donationAlertOuter acmeFontSmall" >
			<div id="preLogoText" >Team Donation! </div>
			<div id="imgDiv" align><img id="pngspin" src="/dice_icon_final.png" width="128px" height="128px"/></div>
			<div id="postLogoText" >Thanks John Doe for $1337! </div>
		</div>
		<audio id="wowplayer">
			<source id="animewow" src="animewow.mp3" type="audio/mp3" />
		</audio>
	</body>
</html>